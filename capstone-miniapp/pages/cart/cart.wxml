<!--pages/cart/cart.wxml-->
<view class="page">
  <view class="main">
    <scroll-view class="left" scroll-y="true" scroll-with-animation="true">
      <block wx:for="{{categories}}" wx:key="id">
        <view 
          class="left-item {{currentCategory == item.id ? 'active' : ''}}"
          data-id="{{item.id}}"
          bindtap="switchCategory"
        >
          {{item.name}}
        </view>
      </block>
    </scroll-view>
    <scroll-view class="right" scroll-y="true" scroll-with-animation="true">
      <block wx:for="{{currentProducts}}" wx:key="id">
        <view class="product-card">
          <image src="{{item.image}}" class="thumb" mode="aspectFill" />
          <view class="info">
            <text class="title">{{item.name}}</text>
            <text class="detail">{{item.detail}}</text>
            <view class="price-box">
              <view class="price">
                <text class="price-small" space="nbsp">¥</text>
                <text class="price-normal" space="nbsp">{{item.price}}</text>
                <text class="price-small" space="nbsp"> 起</text>
              </view>
              <view class="picker">
                <view class="quantity-selector">
                  <image 
                    src="/assets/images/minus.png" 
                    class="quantity-btn minus {{item.quantity <= 0 ? 'disabled' : ''}}" 
                    data-id="{{item.id}}" 
                    bindtap="decreaseQuantity" 
                    hidden="{{item.quantity <= 0}}"
                  />
                  <view class="quantity-display" hidden="{{item.quantity <= 0}}">{{item.quantity || 0}}</view>
                  <image 
                    src="/assets/images/plus.png" 
                    class="quantity-btn plus" 
                    data-id="{{item.id}}" 
                    bindtap="increaseQuantity"
                  />
                </view>
              </view>
            </view>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>
  <view class="cart-bar" wx:if="{{cartTotalQuantity > 0}}">
    <view class="cart-left" bindtap="toggleCartModal">
      <view class="cart-icon-wrapper">
        <image src="/assets/images/cart.png" class="cart-icon" />
        <view class="cart-badge" wx:if="{{cartTotalQuantity > 0}}">{{cartTotalQuantity}}</view>
      </view>
      <text class="cart-total">合计 ¥{{cartTotalAmount}}</text>
    </view>
    <view class="cart-checkout">去结算</view>
  </view>
  <view class="cart-modal" wx:if="{{showCartModal}}">
    <view class="modal-mask" bindtap="hideCartModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">已选商品</text>
        <text class="clear-cart" bindtap="clearCart">清空</text>
      </view>
      <scroll-view class="cart-list" scroll-y="true">
        <block wx:for="{{cartItems}}" wx:key="id">
          <view class="cart-item">
            <image src="{{item.image}}" class="item-thumb" mode="aspectFill" />
            <view class="item-info">
              <text class="item-name">{{item.name}}</text>
              <text class="item-detail">{{item.detail}}</text>
              <view class="item-price">¥{{item.price}}</view>
            </view>
            <view class="item-quantity">
              <image 
                src="/assets/btn/minus.png" 
                class="quantity-btn" 
                data-id="{{item.id}}" 
                bind:tap="decreaseQuantity"
              />
              <text class="quantity-num">{{item.quantity}}</text>
              <image 
                src="/assets/btn/plus.png" 
                class="quantity-btn" 
                data-id="{{item.id}}" 
                bind:tap="increaseQuantity"
              />
            </view>
          </view>
        </block>
      </scroll-view>
      <view class="modal-footer">
        <view class="footer-total">合计 ¥{{cartTotalAmount}}</view>
        <view class="footer-checkout">去结算</view>
      </view>
    </view>
  </view>
</view>